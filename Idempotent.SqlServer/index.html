<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>&#128738; Idempotent.SqlServer | Idempotent </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="&#128738; Idempotent.SqlServer | Idempotent ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

        </div>

        <article data-uid="">
<h1 id="-idempotentsqlserver">ðŸ›¢ Idempotent.SqlServer</h1>

<p><code>Idempotent.SqlServer</code> implements idempotent persistence using Microsoft SQL Server.
It provides durable storage with strict schema validation.</p>
<p>This store prioritizes correctness and durability over raw throughput.</p>
<hr>
<h2 id="-characteristics">ðŸ§¬ Characteristics</h2>
<ul>
<li>Durable persistence</li>
<li>Strong consistency</li>
<li>Schema validation on startup</li>
<li>Explicit column constraints</li>
</ul>
<hr>
<h2 id="-use-cases">ðŸŽ¯ Use Cases</h2>
<ul>
<li>Enterprise systems</li>
<li>Compliance-sensitive workloads</li>
<li>Systems requiring auditability</li>
</ul>
<hr>
<h2 id="-quickstart">ðŸš€ Quickstart</h2>
<h4 id="install-package">Install Package</h4>
<pre><code class="lang-bash">dotnet add package Idempotent.SqlServer
</code></pre>
<h4 id="register-store">Register Store</h4>
<pre><code class="lang-csharp">builder.Services.AddSqlServerStore(
    storeKey: &quot;default&quot;,
    connectionString: &quot;Server=localhost,1433;Database=Idempotent;User Id=sa;Password=sa;TrustServerCertificate=True;Encrypt=True;&quot;,
    schemaName: &quot;dbo&quot;,          // Optional, default value is dbo
    tableName: &quot;Transaction&quot;,   // Optional, default value is Transaction
    forceInitialize: true       // Optional, default value is true
);
</code></pre>
<h4 id="storage-script">Storage Script</h4>
<p>If <strong><code>forceInitialize</code></strong> is set to:</p>
<ul>
<li><strong><code>true</code></strong>: storage is initialized on startup with <code>schemaName</code> and <code>tableName</code>.</li>
<li><strong><code>false</code></strong>: storage must be initialized manually before startup using storage script.
Names (schema, table, constraints) could differ but column names, types and lenghts must remain the same.
Index is optional but recommended to improve eviction performance.</li>
</ul>
<pre><code class="lang-sql">CREATE TABLE [dbo].[Transaction] (
    [Composite] NVARCHAR(512) NOT NULL,
    [Service] NVARCHAR(128) NOT NULL,
    [Method] INT NOT NULL,
    [Path] NVARCHAR(2048) NOT NULL,
    [Querystring] NVARCHAR(2048) NULL,
    [Key] NVARCHAR(256) NOT NULL,
    [State] INT NOT NULL,
    [CreatedUtc] DATETIME2 NOT NULL,
    [CompletedUtc] DATETIME2 NULL,
    [ExpiresUtc] DATETIME2 NULL,
    [Fingerprint] NVARCHAR(MAX) NULL,
    [TimeToLiveMilliseconds] INT NULL,
    [StatusCode] INT NULL,
    [Header] NVARCHAR(MAX) NULL,
    [Body] NVARCHAR(MAX) NULL,
    [OriginalBodyBytes] BIGINT NULL,
    [IsBodyTruncated] BIT NULL,
    [ExtraBodyBytes] BIGINT NULL,
    CONSTRAINT [PK_Transaction_Composite] PRIMARY KEY CLUSTERED ([Composite])
);

CREATE INDEX [IX_Transaction_ExpiresUtc]
    ON [dbo].[Transaction] ([ExpiresUtc])
    WHERE [ExpiresUtc] IS NOT NULL&quot;;
</code></pre>
<hr>
<h2 id="-technical-reference">ðŸ“˜ Technical Reference</h2>
<p>See the API Reference for full technical documentation.</p>

</article>



      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          idempotent-labs Â© 2026
        </div>
      </div>
    </footer>
  </body>
</html>
